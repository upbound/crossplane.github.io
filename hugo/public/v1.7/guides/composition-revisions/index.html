<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Crossplane is a framework for building cloud native control planes without needing to write code. It has a highly extensible backend that enables you to build a control plane that can orchestrate applications and infrastructure no matter where they run, and a highly configurable frontend that puts you in control of the schema of the declarative API it offers.">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    
    
    <meta name="robots" content="noindex">
    <title>| Crossplane Docs</title>
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="https://crossplane.io" />
<meta name="twitter:title" content="Crossplane" />
<meta name="twitter:description" content="The cloud-native control plane framework" />
<meta name="twitter:image:src" content="https://crossplane.io/images/twitter-card_400x400.jpg" /><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png?v=1.0">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png?v=1.0">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png?v=1.0">
<link rel="manifest" href="/favicons/site.webmanifest?v=1.0">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg?v=1.0" color="#5bbad5">
<link rel="shortcut icon" href="/favicons/favicon.ico?v=1.0">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/css/main.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/docs.css" /><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script></head>

  <body>
    <div id="header">
    <div>
      <div class="logo">
        <a href="/"><img src="/images/logo.svg" alt="Crossplane Logo"/></a>
      </div>
      <div
        class="hamburger-controls"
        onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;"
      >
        <span></span>
        <span></span>
        <span></span>
      </div>
      <ul class="links">
        <li>
          <a href="https://github.com/crossplane/crossplane">
            <span class="md-hidden">Get Started on</span> GitHub
          </a>
        </li>
        <li>
          <a href="">Documentation</a>
        </li>
        <li>
          <a href="">Community</a>
        </li>
        <li>
          <a href="https://slack.crossplane.io/">Slack <span class="md-hidden">Channel</span></a>
        </li>
        <li>
          <a href="https://blog.crossplane.io/">Blog</a>
        </li>
        <li>
          <a href="https://twitter.com/crossplane_io">Twitter</a>
        </li>
      </ul>
    </div>
  </div>

    <div class="page">
      <div class="docs-menu">
        <ul id="docs-ul"></ul>
    </div>
    <div class="docs-content">
      




    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        

    
        

    
        

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        

    
        

    
        
        
    

    
        

    
        
        
    

    
        

    
        

    
        

    
        

    
        

    
        

    
        
        
    

    
        
        
    

    
        
        
    

    
        
        
    

    
        

    

    
        

    

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    
        

    

    
        





    

    

    





    
        
    

    
        
    

    
        
    




<div class="versions latest">
    <div><div><select onchange="window.location.href = this.value">
        
        
            
                <option selected="" value="/master/guides/composition-reisions/">Crossplane master pre-release</option>
            
        
        
            
                
                    <option value="/v1.9/guides/composition-revisions/">Crossplane v1.9</option>
                
            
        
            
                
                    <option value="/v1.8/guides/composition-revisions/">Crossplane v1.8</option>
                
            
        
            
                
                    <option selected="" value="/v1.7/guides/composition-revisions/">Crossplane v1.7</option>
                
            
        
    </select></div></div>
</div>


      <h1>Composition Revisions</h1>
      <div class="alert old">
    <p>
        <b>PLEASE NOTE</b>: This document applies to  version and not to the latest release 
    </p>
    <strong>
        Documentation for other releases can be found by using the version selector in the top right of any doc page.
    </strong>
</div>
      <h1 id="composition-revisions">Composition Revisions</h1>
<p>This guide discusses the use of &ldquo;Composition Revisions&rdquo; to safely make and roll
back changes to a Crossplane <a href="../concepts/composition.md"><code>Composition</code></a>. It assumes
familiarity with Crossplane, and particularly with
<a href="../concepts/terminology.md#composition">Composition</a>.</p>
<blockquote>
<p>Composition Revisions are an <strong>alpha feature</strong>. They are not yet recommended
for production use, and are disabled by default.</p>
</blockquote>
<p>A <code>Composition</code> configures how Crossplane should reconcile a Composite Resource
(XR). Put otherwise, when you create an XR the selected <code>Composition</code> determines
what managed resources Crossplane will create in response. Let&rsquo;s say for example
that you define a <code>PlatformDB</code> XR, which represents your organisation&rsquo;s common
database configuration of an Azure MySQL Server and a few firewall rules. The
<code>Composition</code> contains the &lsquo;base&rsquo; configuration for the MySQL server and the
firewall rules that is extended by the configuration for the <code>PlatformDB</code>.</p>
<p>There is a one-to-many relationship between a <code>Composition</code> and the XRs that use
it. You might define a <code>Composition</code> named <code>big-platform-db</code> that is used by ten
different <code>PlatformDB</code> XRs. Usually, in the interest of self-service, the
<code>Composition</code> is managed by a different team from the actual <code>PlatformDB</code> XRs.
For example the <code>Composition</code> may be written and maintained by a platform team
member, while individual application teams create <code>PlatformDB</code> XRs that use said
<code>Composition</code>.</p>
<p>Each <code>Composition</code> is mutable - you can update it as your organisation&rsquo;s needs
change. However, without Composition Revisions updating a <code>Composition</code> can be a
risky process. Crossplane constantly uses the <code>Composition</code> to ensure that your
actual infrastructure - your MySQL Servers and firewall rules - match your
desired state. If you have 10 <code>PlatformDB</code> XRs all using the <code>big-platform-db</code>
<code>Composition</code>, all 10 of those XRs will be instantly updated in accordance with
any updates you make to the <code>big-platform-db</code> <code>Composition</code>.</p>
<p>Composition Revisions allow XRs to opt out of automatic updates. Instead you can
update your XRs to leverage the latest <code>Composition</code> settings at your own pace.
This enables you to <a href="https://martinfowler.com/bliki/CanaryRelease.html">canary</a> changes to your infrastructure, or to roll back
some XRs to previous <code>Composition</code> settings without rolling back all XRs.</p>
<h2 id="enabling-composition-revisions">Enabling Composition Revisions</h2>
<p>Composition Revisions are an alpha feature. They are not yet recommended for
production use, and are disabled by default. Start Crossplane with the
<code>--enable-composition-revisions</code> flag to enable Composition Revision support.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>kubectl create namespace crossplane-system
</span></span><span style="display:flex;"><span>helm install crossplane --namespace crossplane-system crossplane-stable/crossplane --set args=&#39;{--enable-composition-revisions}&#39;
</span></span></code></pre></div><p>See the <a href="../getting-started/install-configure.md">getting started guide</a> for more information on
installing Crossplane.</p>
<h2 id="using-composition-revisions">Using Composition Revisions</h2>
<p>When you enable Composition Revisions three things happen:</p>
<ol>
<li>Crossplane creates a <code>CompositionRevision</code> for each <code>Composition</code> update.</li>
<li>Composite Resources gain a <code>spec.compositionRevisionRef</code> field that specifies
which <code>CompositionRevision</code> they use.</li>
<li>Composite Resources gain a <code>spec.compositionUpdatePolicy</code> field that
specifies how they should be updated to new Composition Revisions.</li>
</ol>
<p>Each time you edit a <code>Composition</code> Crossplane will automatically create a
<code>CompositionRevision</code> that represents that &lsquo;revision&rsquo; of the <code>Composition</code> -
that unique state. Each revision is allocated an increasing revision number.
This gives <code>CompositionRevision</code> consumers an idea about which revision is
&rsquo;newest&rsquo;.</p>
<p>Crossplane distinguishes between the &rsquo;newest&rsquo; and the &lsquo;current&rsquo; revision of a
<code>Composition</code>. That is, if you revert a <code>Composition</code> to a previous state that
corresponds to an existing <code>CompositionRevision</code> that revision will become
&lsquo;current&rsquo; even if it is not the &rsquo;newest&rsquo; revision (i.e. the most latest <em>unique</em>
<code>Composition</code> configuration).</p>
<p>You can discover which revisions exist using <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span># Find all revisions of the Composition named <span style="color:#e6db74">&#39;example&#39;</span>
</span></span><span style="display:flex;"><span>kubectl get compositionrevision -l crossplane.io/composition-name=example
</span></span></code></pre></div><p>This should produce output something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>NAME            REVISION   CURRENT   AGE
</span></span><span style="display:flex;"><span>example-18pdg   1          False     4m36s
</span></span><span style="display:flex;"><span>example-2bgdr   2          True      73s
</span></span><span style="display:flex;"><span>example-xjrdm   3          False     61s
</span></span></code></pre></div><blockquote>
<p>A <code>Composition</code> is a mutable resource that you can update as your needs
change over time. Each <code>CompositionRevision</code> is an immutable snapshot of those
needs at a particular point in time.</p>
</blockquote>
<p>Crossplane behaves the same way by default whether Composition Revisions are
enabled or not. This is because when you enable Composition Revisions all XRs
default to the <code>Automatic</code> <code>compositionUpdatePolicy</code>. XRs support two update
policies:</p>
<ul>
<li><code>Automatic</code>: Automatically use the current <code>CompositionRevision</code>. (Default)</li>
<li><code>Manual</code>: Require manual intervention to change <code>CompositionRevision</code>.</li>
</ul>
<p>The below XR uses the <code>Manual</code> policy. When this policy is used the XR will
select the current <code>CompositionRevision</code> when it is first created, but must
manually be updated when you wish it to use another <code>CompositionRevision</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">example.org/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PlatformDB</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">example</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageGB</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># The Manual policy specifies that you do not want this XR to update to the</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># current CompositionRevision automatically.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">compositionUpdatePolicy</span>: <span style="color:#ae81ff">Manual</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">compositionRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">example</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">writeConnectionSecretToRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">db-conn</span>
</span></span></code></pre></div><p>Crossplane sets an XR&rsquo;s <code>compositionRevisionRef</code> automatically at creation time
regardless of your chosen <code>compositionUpdatePolicy</code>. If you choose the <code>Manual</code>
policy you must edit the <code>compositionRevisionRef</code> field when you want your XR to
use a different <code>CompositionRevision</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">example.org/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PlatformDB</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">example</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageGB</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">compositionUpdatePolicy</span>: <span style="color:#ae81ff">Manual</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">compositionRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">example</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Update the referenced CompositionRevision if and when you are ready.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">compositionRevisionRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">example-18pdg</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">writeConnectionSecretToRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">db-conn</span>
</span></span></code></pre></div>
    </div>
    </div>

    


<script>
    var menu = [];

    function add(name, url, isChild, current) {
        var item = { name: name, url: url, current: current };
        var container = menu;
        if (isChild && menu.length > 0) {
            menu[menu.length-1].children = menu[menu.length-1].children || [];
            container = menu[menu.length-1].children;
            if (current) {
                menu[menu.length-1].childCurrent = true;
            }
        }
        container.push(item);
    }



    function getEntry(item) {
        var itemDom = document.createElement('li');

        if (item.current) {
            itemDom.innerHTML = item.name;
            itemDom.classList.add('current');
        } else {
            itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
        }

        return itemDom;
    }

    
    
    function flushCss(element) {
        element.offsetHeight;
    }

    function addArrow(itemDom) {
        var arrowDom = document.createElement('a');
        arrowDom.classList.add('arrow');
        arrowDom.innerHTML = '<div />';
        arrowDom.onclick = function(itemDom) {
            return function () {
                var MAIN_ITEM_HEIGHT = 59;
                var BOTTOM_PADDING = 16;

                
                var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

                itemDom.classList.toggle('open');

                if (itemDom.classList.contains('open')) {
                    itemDom.style.height = fullHeight;
                } else {
                    
                    
                    if (itemDom.style.height === 'auto') {
                        itemDom.style.transition = 'none';
                        itemDom.style.height = fullHeight;
                        flushCss(itemDom);
                        itemDom.style.transition = '';
                    }
                    itemDom.style.height = '59px';
                }

                return false;
            };
        }(itemDom);
        itemDom.appendChild(arrowDom);

        if ((item.current && item.children) || item.childCurrent) {
            itemDom.classList.add('open');
            itemDom.style.height = 'auto';
        } else {
            itemDom.style.height = '59px';
        }
    }

    var menuDom = document.getElementById('docs-ul');
    for (var i = 0; i < menu.length; i++) {
        var item = menu[i];
        var itemDom = getEntry(item);

        if (item.childCurrent) {
            itemDom.classList.add('childCurrent');
        }

        if (item.children) {
            addArrow(itemDom);
            itemDom.classList.add('children');
            var children = document.createElement('ul');
            for (var j = 0; j < item.children.length; j++) {
                children.appendChild(getEntry(item.children[j]));
            }
            itemDom.appendChild(children);
        }
        menuDom.appendChild(itemDom);
    }
</script>
    <div id="footer">
    <div class="footer-main">
      <div class="main">
        <div class="logo"><img src="/images/logo.svg" alt="Crossplane Logo" /></div>
      </div>
      <div class="links sm-hidden">
        <a href='https://twitter.com/crossplane_io'>Twitter</a>
        <a href=''>Documentation</a>
        <a href='https://github.com/crossplane/crossplane'>GitHub</a>
        <a href='https://slack.crossplane.io/'>Slack Channel</a>
        <a href='https://www.youtube.com/channel/UC19FgzMBMqBro361HbE46Fw'>YouTube</a>
        <a href='https://groups.google.com/forum/#!forum/crossplane-dev'>Forum</a>
      </div>
    </div>
    <div class="lf-copyright">
      <p>
        &#169; Crossplane Authors 2022. Documentation distributed under
        <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
      </p>
      <p>
        &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
        registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
        <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
      </p>
    </div>
    <script src="/js/slack-popup.js"></script>
    
      <script src="/js/anchor.js"></script>
      <script>
        anchors.options = {
          placement: 'right',
          icon: '#',
        }

        document.addEventListener('DOMContentLoaded', function(event) {
          anchors.add('.docs-content h1, .docs-content h2, .docs-content h3, .docs-content h4, .docs-content h5, .docs-content h6');
        });
      </script>
    
  </div>

    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-110275540-2', 'auto');
    ga('send', 'pageview');
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-SFCPQYSLHY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SFCPQYSLHY');
</script>
    
  <script type="text/javascript" id="hs-script-loader" async defer src="https://js.hs-scripts.com/5557732.js"></script>


  </body>
</html>