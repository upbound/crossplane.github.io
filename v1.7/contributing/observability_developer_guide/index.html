<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Crossplane is a framework for building cloud native control planes without needing to write code. It has a highly extensible backend that enables you to build a control plane that can orchestrate applications and infrastructure no matter where they run, and a highly configurable frontend that puts you in control of the schema of the declarative API it offers."><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=robots content="noindex"><title>Observability Developer Guide| Crossplane Documentation</title><meta name=twitter:card content="summary"><meta name=twitter:site content="https://crossplane.io"><meta name=twitter:title content="Crossplane"><meta name=twitter:description content="The cloud-native control plane framework"><meta name=twitter:image:src content="https://crossplane.io/images/twitter-card_400x400.jpg"><link rel=apple-touch-icon sizes=180x180 href="/favicons/apple-touch-icon.png?v=1.0"><link rel=icon type=image/png sizes=32x32 href="/favicons/favicon-32x32.png?v=1.0"><link rel=icon type=image/png sizes=16x16 href="/favicons/favicon-16x16.png?v=1.0"><link rel=manifest href="/favicons/site.webmanifest?v=1.0"><link rel=mask-icon href="/favicons/safari-pinned-tab.svg?v=1.0" color=#5bbad5><link rel="shortcut icon" href="/favicons/favicon.ico?v=1.0"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css><link rel=stylesheet href=/css/docs.css><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js></script></head><body><div id=header><div><div class=logo><a href=/><img src=/images/logo.svg alt="Crossplane Logo"></a></div><div class=hamburger-controls onclick='return document.body.classList.contains("menu-open")?document.body.classList.remove("menu-open"):document.body.classList.add("menu-open"),!1'><span></span>
<span></span>
<span></span></div><ul class=links><li><a href=https://github.com/crossplane/crossplane><span class=md-hidden>Get Started on</span> GitHub</a></li><li><a href=/v1.9/>Documentation</a></li><li><a href=/community/>Community</a></li><li><a href=https://slack.crossplane.io/>Slack <span class=md-hidden>Channel</span></a></li><li><a href=https://blog.crossplane.io/>Blog</a></li><li><a href=https://twitter.com/crossplane_io>Twitter</a></li></ul></div></div><div id=docs-header><div><h1>Documentation</h1><div class=versions><div><div><select onchange="window.location.href=this.value"><option selected value=/master/contributing/observability_developer_guide/>Crossplane master</option><option value=/v1.9/contributing/observability_developer_guide/>Crossplane v1.9</option><option value=/v1.8/contributing/observability_developer_guide/>Crossplane v1.8</option><option selected value=/v1.7/contributing/observability_developer_guide/>Crossplane v1.7</option></select></div></div></div></div></div><div class=page><div class=docs-menu><ul id=docs-ul></ul></div><div class=docs-content><div class=docs-actions><a id=edit href=https://github.com/crossplane/crossplane/tree/release-1.7/docs/observability_developer_guide.md><img src=/images/github-teal.svg>Edit on GitHub</a></div><div class="alert old"><p><b>PLEASE NOTE</b>: This document applies to version 1.7 and not to the latest release 1.9</p><strong>Documentation for other releases can be found by using the version selector in the top right of any doc page.</strong></div><h1>Observability Developer Guide</h1><h2 id=introduction>Introduction</h2><p>Observability is crucial to Crossplane users; both those operating Crossplane
and those using Crossplane to operate their infrastructure. Crossplane currently
approaches observability via Kubernetes events and structured logs.</p><h2 id=goals>Goals</h2><p>In short, a non-admin user and an admin user should both be able to debug any
issues only by inspecting logs and events. There should be no need to rebuild
the Crossplane binary or to reach out to a Crossplane developer.</p><p>A user should be able to:</p><ul><li>Debug an issue without rebuilding the Crossplane binary</li><li>Understand an issue without contacting a cluster admin</li><li>Ask a cluster admin to check the logs for more details about the reason the
issue happened, if the details are not part of the error message</li></ul><p>A cluster admin should be able to:</p><ul><li>Debug an issue without rebuilding the Crossplane binary</li><li>Debug an issue only by looking at the logs</li><li>Debug an issue without needing to contact a Crossplane developer</li></ul><h2 id=error-reporting-in-the-logs>Error reporting in the logs</h2><p>Error reporting in the logs is mostly intended for consumption by Crossplane
cluster admins. A cluster admin should be able to debug any issue by inspecting
the logs, without needing to add more logs themselves or contact a Crossplane
developer. This means that logs should contain:</p><ul><li>Error messages, at either the info or debug level as contextually appropriate</li><li>Any context leading up to an error, typically at debug level, so that the
errors can be debugged</li></ul><h2 id=error-reporting-as-events>Error reporting as events</h2><p>Error reporting as Kubernetes events is primarily aimed toward end-users of
Crossplane who are not cluster admins. Crossplane typically runs as a Kubernetes
pod, and thus it is unlikely that most users of Crossplane will have access to
its logs. <a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#event-v1-core>Events</a>, on the other hand, are available as top-level Kubernetes
objects, and show up the objects they relate to when running <code>kubectl describe</code>.</p><p>Events should be recorded in the following cases:</p><ul><li>A significant operation is taken on a resource</li><li>The state of a resource is changed</li><li>An error occurs</li></ul><p>The events recorded in these cases can be thought of as forming an event log of
things that happen for the resources that Crossplane manages. Each event should
refer back to the relevant controller and resource, and use other fields of the
Event kind as appropriate.</p><p>More details about examples of how to interact with events can be found in the
guide to <a href=https://kubernetes.io/docs/tasks/debug-application-cluster/>debugging an application cluster</a>.</p><h2 id=choosing-between-methods-of-error-reporting>Choosing between methods of error reporting</h2><p>There are many ways to report errors, such as:</p><ul><li>Metrics</li><li>Events</li><li>Logging</li><li>Tracing</li></ul><p>It can be confusing to figure out which one is appropriate in a given situation.
This section will try to offer advice and a mindset that can be used to help
make this decision.</p><p>Let&rsquo;s set the context by listing the different user scenarios where error
reporting may be consumed. Here are the typical scenarios as we imagine them:</p><ol><li>A person <strong>using</strong> a system needs to figure out why things aren&rsquo;t working as
expected, and whether they made a mistake that they can correct.</li><li>A person <strong>operating</strong> a service needs to monitor the service&rsquo;s <strong>health</strong>,
both now and historically.</li><li>A person <strong>debugging</strong> a problem which happened in a <strong>live environment</strong>
(often an <strong>operator</strong> of the system) needs information to figure out what
happened.</li><li>A person <strong>developing</strong> the software wants to <strong>observe</strong> what is happening.</li><li>A person <strong>debugging</strong> the software in a <strong>development environment</strong>
(typically a <strong>developer</strong> of the system) wants to debug a problem (there is
a lot of overlap between this and the live environment debugging scenario).</li></ol><p>The goal is to satisfy the users in all of the scenarios. We&rsquo;ll refer to the
scenarios by number.</p><p>The short version is: we should do whatever satisfies all of the scenarios.
Logging and events are the recommendations for satisfying the scenarios,
although they don&rsquo;t cover scenario 2.</p><p>The longer version is:</p><ul><li>Scenario 1 is best served by events in the context of Crossplane, since the
users may not have access to read logs or metrics, and even if they did, it
would be hard to relate them back to the event the user is trying to
understand.</li><li>Scenario 2 is best served by metrics, because they can be aggregated and
understood as a whole. And because they can be used to track things over time.</li><li>Scenario 3 is best served by either logging that contains all the information
about and leading up to the event. Request-tracing systems are also useful for
this scenario.</li><li>Scenario 4 is usually logs, maybe at a more verbose level than normal. But it
could be an attached debugger or some other type of tool. It could also be a
test suite.</li><li>Scenario 5 is usually either logs, up to the highest imaginable verbosity, or
an attached debugging session. If there&rsquo;s a gap in reporting, it could involve
adding some print statements to get more logging.</li></ul><p>As for the question of how to decide whether to log or not, we believe it helps
to try to visualize which of the scenarios the error or information in question
will be used for. We recommend starting with reporting as much information as
possible, but with configurable runtime behavior so that, for example, debugging
logs don&rsquo;t show up in production normally.</p><p>For the question of what constitutes an error, errors should be actionable by a
human. See the <a href=https://dave.cheney.net/2015/11/05/lets-talk-about-logging>Dave Cheney article</a> on this topic for some more discussion.</p><h2 id=in-practice>In Practice</h2><p>Crossplane provides two observability libraries as part of crossplane-runtime:</p><ul><li><a href=https://godoc.org/github.com/crossplane/crossplane-runtime/pkg/event><code>event</code></a> emits Kubernetes events.</li><li><a href=https://godoc.org/github.com/crossplane/crossplane-runtime/pkg/logging><code>logging</code></a> produces structured logs. Refer to its package documentation for
additional context on its API choices.</li></ul><p>Keep the following in mind when using the above libraries:</p><ul><li><a href=https://peter.bourgon.org/go-best-practices-2016/#logging-and-instrumentation>Do</a> <a href=https://dave.cheney.net/2017/01/23/the-package-level-logger-anti-pattern>not</a> use package level loggers or event recorders. Instantiate them in
<code>main()</code> and plumb them down to where they&rsquo;re needed.</li><li>Each <a href=https://godoc.org/sigs.k8s.io/controller-runtime/pkg/reconcile#Reconciler><code>Reconciler</code></a> implementation should use its own <code>logging.Logger</code> and
<code>event.Recorder</code>. Implementations are strongly encouraged to default to using
<code>logging.NewNopLogger()</code> and <code>event.NewNopRecorder()</code>, and accept a functional
loggers and recorder via variadic options. See for example the <a href=https://github.com/crossplane/crossplane-runtime/blob/a6bb0/pkg/reconciler/managed/reconciler.go#L436>managed
resource reconciler</a>.</li><li>Each controller should use its name as its event recorder&rsquo;s name, and include
its name under the <code>controller</code> structured logging key. The controllers name
should be of the form <code>controllertype/resourcekind</code>, for example
<code>managed/cloudsqlinstance</code> or <code>stacks/stackdefinition</code>. Controller names
should always be lowercase.</li><li>Logs and events should typically be emitted by the <code>Reconcile</code> method of the
<code>Reconciler</code> implementation; not by functions called by <code>Reconcile</code>. Author
the methods orchestrated by <code>Reconcile</code> as if they were a library; prefer
surfacing useful information for the <code>Reconciler</code> to log (for example by
<a href=https://godoc.org/github.com/pkg/errors#Wrap>wrapping errors</a>) over plumbing loggers and event recorders down to
increasingly deeper layers of code.</li><li>Almost nothing is worth logging at info level. When deciding which logging
level to use, consider a production deployment of Crossplane reconciling tens
or hundreds of managed resources. If in doubt, pick debug. You can easily
increase the log level later if it proves warranted.</li><li>The above is true even for errors; consider the audience. Is this an error
only the Crossplane cluster operator can fix? Does it indicate a significant
degradation of Crossplane&rsquo;s functionality? If so, log it at info. If the error
pertains to a single Crossplane resource emit an event instead.</li><li>Always log errors under the structured logging key <code>error</code> (e.g.
<code>log.Debug("boom!, "error", err)</code>). Many logging implementations (including
Crossplane&rsquo;s) add context like stack traces for this key.</li><li>Emit events liberally; they&rsquo;re rate limited and deduplicated.</li><li>Follow <a href=https://github.com/kubernetes/community/blob/09f55c6/contributors/devel/sig-architecture/api-conventions.md#events>API conventions</a> when emitting events; ensure event reasons are unique
and <code>CamelCase</code>.</li><li>Consider emitting events and logs when a terminal condition is encountered
(e.g. <code>Reconcile</code> returns) over logging logic flow. i.e. Prefer one log line
that reads &ldquo;encountered an error fooing the bar&rdquo; over two log lines that read
&ldquo;about to foo the bar&rdquo; and &ldquo;encountered an error&rdquo;. Recall that if the audience
is a developer debugging Crossplane they will be provided a stack trace with
file and line context when an error is logged.</li><li>Consider including the <code>reconcile.Request</code>, and the resource&rsquo;s UID and
resource version (not API version) under the keys <code>request</code>, <code>uid</code>, and
<code>version</code>. Doing so allows log readers to determine what specific version of a
resource the log pertains to.</li></ul><p>Finally, when in doubt, aim for consistency with existing Crossplane controller
implementations.</p></div></div><script>var i,j,menu=[],menuDom,item,itemDom,children;menu.push({childCurrent:!1,children:[{current:!1,name:"Install \u0026 Configure",url:"/v1.7/getting-started/install-configure/"},{current:!1,name:"Provision Infrastructure",url:"/v1.7/getting-started/provision-infrastructure/"},{current:!1,name:"Create a Configuration",url:"/v1.7/getting-started/create-configuration/"}],current:!1,name:"Getting Started",url:"/v1.7/getting-started/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Providers",url:"/v1.7/concepts/providers/"},{current:!1,name:"Managed Resources",url:"/v1.7/concepts/managed-resources/"},{current:!1,name:"Composite Resources",url:"/v1.7/concepts/composition/"},{current:!1,name:"Packages",url:"/v1.7/concepts/packages/"},{current:!1,name:"Terminology",url:"/v1.7/concepts/terminology/"}],current:!1,name:"Concepts",url:"/v1.7/concepts/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Upgrading to v0.14",url:"/v1.7/guides/upgrading-to-v0.14/"},{current:!1,name:"Upgrading to v1.x",url:"/v1.7/guides/upgrading-to-v1.x/"},{current:!1,name:"Vault as an External Secret Store",url:"/v1.7/guides/vault-as-secret-store/"},{current:!1,name:"Vault Credential Injection",url:"/v1.7/guides/vault-injection/"},{current:!1,name:"Multi-Tenant Crossplane",url:"/v1.7/guides/multi-tenant/"},{current:!1,name:"Composition Revisions",url:"/v1.7/guides/composition-revisions/"},{current:!1,name:"Self-Signed CA Certs",url:"/v1.7/guides/self-signed-ca-certs/"}],current:!1,name:"Guides",url:"/v1.7/guides/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Install Crossplane",url:"/v1.7/reference/install/"},{current:!1,name:"Configure Your Cloud Provider Account",url:"/v1.7/reference/configure/"},{current:!1,name:"Uninstall",url:"/v1.7/reference/uninstall/"},{current:!1,name:"Composition",url:"/v1.7/reference/composition/"},{current:!1,name:"xpkg Specification",url:"/v1.7/reference/xpkg/"},{current:!1,name:"Troubleshoot",url:"/v1.7/reference/troubleshoot/"},{current:!1,name:"Learn More",url:"/v1.7/reference/learn_more/"},{current:!1,name:"Release Cycle",url:"/v1.7/reference/release-cycle/"}],current:!1,name:"Reference",url:"/v1.7/reference/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"crossplane",url:"/v1.7/api-docs/crossplane/"},{current:!1,name:"provider-alibaba",url:"/v1.7/api-docs/provider-alibaba/"},{current:!1,name:"provider-aws",url:"/v1.7/api-docs/provider-aws/"},{current:!1,name:"provider-azure",url:"/v1.7/api-docs/provider-azure/"},{current:!1,name:"provider-gcp",url:"/v1.7/api-docs/provider-gcp/"},{current:!1,name:"provider-rook",url:"/v1.7/api-docs/provider-rook/"},{current:!1,name:"provider-helm",url:"/v1.7/api-docs/provider-helm/"}],current:!1,name:"API Documentation",url:"/v1.7/api-docs/"}),menu.push({childCurrent:!0,children:[{current:!1,name:"Provider Development Guide",url:"/v1.7/contributing/provider_development_guide/"},{current:!0,name:"Observability Developer Guide",url:"/v1.7/contributing/observability_developer_guide/"},{current:!1,name:"Release Process",url:"/v1.7/contributing/release-process/"},{current:!1,name:"Adding Secret Store Support",url:"/v1.7/contributing/adding_external_secret_store_support/"}],current:!1,name:"Contributing",url:"/v1.7/contributing/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Related Projects",url:"/v1.7/faqs/related_projects/"}],current:!1,name:"FAQ",url:"/v1.7/faqs/"});function getEntry(e){var t=document.createElement("li");return e.current?(t.innerHTML=e.name,t.classList.add("current")):t.innerHTML='<a href="'+e.url+'">'+e.name+"</a>",t}function flushCss(e){e.offsetHeight}function addArrow(e){var t=document.createElement("a");t.classList.add("arrow"),t.innerHTML="<div />",t.onclick=function(e){return function(){var n=59,s=16,t=n+s+e.lastChild.clientHeight+"px";return e.classList.toggle("open"),e.classList.contains("open")?e.style.height=t:(e.style.height==="auto"&&(e.style.transition="none",e.style.height=t,flushCss(e),e.style.transition=""),e.style.height="59px"),!1}}(e),e.appendChild(t),item.current&&item.children||item.childCurrent?(e.classList.add("open"),e.style.height="auto"):e.style.height="59px"}menuDom=document.getElementById("docs-ul");for(i=0;i<menu.length;i++){if(item=menu[i],itemDom=getEntry(item),item.childCurrent&&itemDom.classList.add("childCurrent"),item.children){addArrow(itemDom),itemDom.classList.add("children"),children=document.createElement("ul");for(j=0;j<item.children.length;j++)children.appendChild(getEntry(item.children[j]));itemDom.appendChild(children)}menuDom.appendChild(itemDom)}</script><script src=/js/anchor.js></script>
<script>anchors.options={placement:"right",icon:"#"},document.addEventListener("DOMContentLoaded",function(){anchors.add(".docs-content h1, .docs-content h2, .docs-content h3, .docs-content h4, .docs-content h5, .docs-content h6")})</script><div id=footer><div class=footer-main><div class=main><div class=logo><img src=/images/logo.svg alt="Crossplane Logo"></div></div><div class="links sm-hidden"><a href=https://twitter.com/crossplane_io>Twitter</a>
<a href=/v1.9/>Documentation</a>
<a href=https://github.com/crossplane/crossplane>GitHub</a>
<a href=https://slack.crossplane.io/>Slack Channel</a>
<a href=https://www.youtube.com/channel/UC19FgzMBMqBro361HbE46Fw>YouTube</a>
<a href=https://groups.google.com/forum/#!forum/crossplane-dev>Forum</a></div></div><div class=lf-copyright><p>&#169; Crossplane Authors 2022. Documentation distributed under
<a href=https://creativecommons.org/licenses/by/4.0/>CC-BY-4.0</a>.</p><p>&#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
<a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> page.</p></div><script src=/js/slack-popup.js></script></div><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-110275540-2","auto"),ga("send","pageview")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-SFCPQYSLHY"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SFCPQYSLHY")</script><script type=text/javascript id=hs-script-loader async defer src=https://js.hs-scripts.com/5557732.js></script></body></html>