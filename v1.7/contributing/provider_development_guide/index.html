<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Crossplane is a framework for building cloud native control planes without needing to write code. It has a highly extensible backend that enables you to build a control plane that can orchestrate applications and infrastructure no matter where they run, and a highly configurable frontend that puts you in control of the schema of the declarative API it offers."><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=robots content="noindex"><title>Provider Development Guide| Crossplane Documentation</title><meta name=twitter:card content="summary"><meta name=twitter:site content="https://crossplane.io"><meta name=twitter:title content="Crossplane"><meta name=twitter:description content="The cloud-native control plane framework"><meta name=twitter:image:src content="https://crossplane.io/images/twitter-card_400x400.jpg"><link rel=apple-touch-icon sizes=180x180 href="/favicons/apple-touch-icon.png?v=1.0"><link rel=icon type=image/png sizes=32x32 href="/favicons/favicon-32x32.png?v=1.0"><link rel=icon type=image/png sizes=16x16 href="/favicons/favicon-16x16.png?v=1.0"><link rel=manifest href="/favicons/site.webmanifest?v=1.0"><link rel=mask-icon href="/favicons/safari-pinned-tab.svg?v=1.0" color=#5bbad5><link rel="shortcut icon" href="/favicons/favicon.ico?v=1.0"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css><link rel=stylesheet href=/css/docs.css><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js></script></head><body><div id=header><div><div class=logo><a href=/><img src=/images/logo.svg alt="Crossplane Logo"></a></div><div class=hamburger-controls onclick='return document.body.classList.contains("menu-open")?document.body.classList.remove("menu-open"):document.body.classList.add("menu-open"),!1'><span></span>
<span></span>
<span></span></div><ul class=links><li><a href=https://github.com/crossplane/crossplane><span class=md-hidden>Get Started on</span> GitHub</a></li><li><a href=/v1.9/>Documentation</a></li><li><a href=/community/>Community</a></li><li><a href=https://slack.crossplane.io/>Slack <span class=md-hidden>Channel</span></a></li><li><a href=https://blog.crossplane.io/>Blog</a></li><li><a href=https://twitter.com/crossplane_io>Twitter</a></li></ul></div></div><div id=docs-header><div><h1>Documentation</h1><div class=versions><div><div><select onchange="window.location.href=this.value"><option selected value=/master/contributing/provider_development_guide/>Crossplane master</option><option value=/v1.9/contributing/provider_development_guide/>Crossplane v1.9</option><option value=/v1.8/contributing/provider_development_guide/>Crossplane v1.8</option><option selected value=/v1.7/contributing/provider_development_guide/>Crossplane v1.7</option></select></div></div></div></div></div><div class=page><div class=docs-menu><ul id=docs-ul></ul></div><div class=docs-content><div class=docs-actions><a id=edit href=https://github.com/crossplane/crossplane/tree/release-1.7/docs/provider_development_guide.md><img src=/images/github-teal.svg>Edit on GitHub</a></div><div class="alert old"><p><b>PLEASE NOTE</b>: This document applies to version 1.7 and not to the latest release 1.9</p><strong>Documentation for other releases can be found by using the version selector in the top right of any doc page.</strong></div><h1>Provider Development Guide</h1><p>Crossplane allows you to manage infrastructure directly from Kubernetes. Each
infrastructure API resource that Crossplane orchestrates is known as a &ldquo;managed
resource&rdquo;. This guide will walk through the process of adding support for a new
kind of managed resource to a Crossplane Provider.</p><blockquote><p>You can watch <a href="https://www.youtube.com/watch?v=rvQ8N0u3rkE&t=7s">TBS Episode 18</a> to follow along the live implementation of GCP PubSub
managed resource.</p></blockquote><blockquote><p>If there is a corresponding Terraform Provider, please consider generating
a Crossplane Provider with <a href=https://github.com/crossplane/terrajet>Terrajet</a> by following the
<a href=https://github.com/crossplane/terrajet/blob/main/docs/generating-a-provider.md>Generating a Crossplane Provider guide</a>.</p></blockquote><blockquote><p>If you plan to implement a managed resource for AWS, please see the
<a href=https://github.com/crossplane-contrib/provider-aws/blob/master/CODE_GENERATION.md>code generation guide</a>.</p></blockquote><h2 id=what-makes-a-crossplane-infrastructure-resource>What Makes a Crossplane Infrastructure Resource</h2><p>Crossplane builds atop Kubernetes&rsquo;s powerful architecture in which declarative
configuration, known as resources, are continually &lsquo;reconciled&rsquo; with reality by
one or more controllers. A controller is an endless loop that:</p><ol><li>Observes the desired state (the declarative configuration resource).</li><li>Observes the actual state (the thing said configuration resource represents).</li><li>Tries to make the actual state match the desired state.</li></ol><p>Typical Crossplane managed infrastructure consists of two configuration
resources and one controller. The GCP Provider&rsquo;s support for Google Cloud
Memorystore illustrates this. First, the configuration resources:</p><ol><li>A <a href=/v1.7/concepts/managed-resources/>managed resource</a>. Managed resources are cluster scoped, high-fidelity
representations of a resource in an external system such as a cloud
provider&rsquo;s API. Managed resources are <em>non-portable</em> across external systems
(i.e. cloud providers); they&rsquo;re tightly coupled to the implementation details
of the external resource they represent. Managed resources are defined by a
Provider. The GCP Provider&rsquo;s <a href=https://github.com/crossplane/provider-gcp/blob/85a6ed3c669a021f1d61be51b2cbe2714b0bc70b/apis/cache/v1beta1/cloudmemorystore_instance_types.go#L184><code>CloudMemorystoreInstance</code></a> resource is an
example of a managed resource.</li><li>A provider. Providers enable access to an external system, typically by
indicating a Kubernetes Secret containing any credentials required to
authenticate to the system, as well as any other metadata required to
connect. Providers are cluster scoped, like managed resources and classes.
The GCP <a href=https://github.com/crossplane/provider-gcp/blob/be5aaf6/apis/v1beta1/providerconfig_types.go#L39><code>ProviderConfig</code></a> is an example of a provider. Note that provider is a
somewhat overloaded term in the Crossplane ecosystem - it&rsquo;s also used to
refer to the controller manager for a particular cloud, for example
<code>provider-gcp</code>.</li></ol><p>A managed resource is powered by a controller. This controller is responsible
for taking instances of the aforementioned high-fidelity managed resource kind
and reconciling them with an external system. The <code>CloudMemorystoreInstance</code>
controller watches for changes to <code>CloudMemorystoreInstance</code> resources and calls
Google&rsquo;s Cloud Memorystore API to create, update, or delete an instance as
necessary.</p><p>Crossplane does not require controllers to be written in any particular
language. The Kubernetes API server is our API boundary, so any process capable
of <a href=https://kubernetes.io/docs/reference/using-api/api-concepts/#efficient-detection-of-changes>watching the API server</a> and updating resources can be a Crossplane
controller.</p><h2 id=getting-started>Getting Started</h2><p>At the time of writing all Crossplane Services controllers are written in Go,
and built using <a href=https://github.com/crossplane/crossplane-runtime/>crossplane-runtime</a>. While it is possible to write a controller
using any language and tooling with a Kubernetes client this set of tools are
the &ldquo;<a href=https://charity.wtf/2018/12/02/software-sprawl-the-golden-path-and-scaling-teams-with-agency/>golden path</a>&rdquo;. They&rsquo;re well supported, broadly used, and provide a shared
language with the Crossplane community. This guide targets <a href=https://github.com/crossplane/crossplane-runtime/releases/tag/v0.9.0>crossplane-runtime
v0.9.0</a>. It assumes the reader is familiar with the Kubernetes <a href=https://github.com/kubernetes/community/blob/c6e1e89a/contributors/devel/sig-architecture/api-conventions.md>API Conventions</a>
and the <a href=https://book.kubebuilder.io/>kubebuilder book</a>.</p><blockquote><p>If you are building a new provider from scratch, instead of adding new
resources to an already existing one, please use <a href=https://github.com/crossplane/provider-template>provider-template</a> repository
as a template by hitting the <code>Use this template</code> button in GitHub UI. It
codifies most of the best practices used by the Crossplane community so far and
is the easiest way to start a new provider.</p></blockquote><h2 id=defining-resource-kinds>Defining Resource Kinds</h2><p>Let&rsquo;s assume we want to add Crossplane support for your favourite cloud&rsquo;s
database-as-a-service. Your favourite cloud brands these instances as &ldquo;Favourite
DB instances&rdquo;. Under the hood they&rsquo;re powered by the open source FancySQL
engine. We&rsquo;ll name the new managed resource kind <code>FavouriteDBInstance</code>.</p><p>The first step toward implementing a new managed service is to define the code
level schema of its configuration resources. These are referred to as
<a href=https://kubebuilder.io/cronjob-tutorial/gvks.html#kinds-and-resources>resources</a>, (resource) <a href=https://kubebuilder.io/cronjob-tutorial/gvks.html#kinds-and-resources>kinds</a>, and <a href=https://kubernetes.io/docs/concepts/#kubernetes-objects>objects</a> interchangeably. The kubebuilder
scaffolding is a good starting point for any new Crossplane API kind.</p><blockquote><p>Note that while Crossplane was originally derived from kubebuilder scaffolds
its patterns have diverged somewhat. It is <em>possible</em> to use kubebuilder to
scaffold a resource, but the author must be careful to adapt said resource to
Crossplane patterns. It may often be quicker to copy and modify a v1beta1 or
above resource from the same provider repository, rather than using
kubebuilder.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>kubebuilder create api \
</span></span><span style=display:flex><span>    --group example --version v1alpha1 --kind FavouriteDBInstance \
</span></span><span style=display:flex><span>    --resource=true --controller=false --namespaced=false
</span></span></code></pre></div><p>The above command should produce a scaffold similar to the below example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstanceSpec</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// INSERT ADDITIONAL SPEC FIELDS - desired state of infrastructure
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// Important: Run &#34;make&#34; to regenerate code after modifying this file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// FavouriteDBInstanceStatus defines the observed state of FavouriteDBInstance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstanceStatus</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// INSERT ADDITIONAL STATUS FIELD - define observed state of infrastructure
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// Important: Run &#34;make&#34; to regenerate code after modifying this file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// +kubebuilder:object:root=true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// FavouriteDBInstance is the Schema for the favouritedbinstance API
</span></span></span><span style=display:flex><span><span style=color:#75715e>// +kubebuilder:resource:scope=Cluster
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstance</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>TypeMeta</span>   <span style=color:#e6db74>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ObjectMeta</span> <span style=color:#e6db74>`json:&#34;metadata,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Spec</span>   <span style=color:#a6e22e>FavouriteDBInstanceeSpec</span>  <span style=color:#e6db74>`json:&#34;spec,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span> <span style=color:#a6e22e>FavouriteDBInstanceStatus</span> <span style=color:#e6db74>`json:&#34;status,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Crossplane requires that these newly generated API type scaffolds be extended
with a set of struct fields, getters, and setters that are standard to all
Crossplane resource kinds. The getters and setter methods required to satisfy
crossplane-runtime interfaces are omitted from the below examples for brevity.
They can be added by hand, but new services are encouraged to use <a href=https://github.com/crossplane/crossplane-tools><code>angryjet</code></a>
to generate them automatically using a <code>//go:generate</code> comment per the
<a href=https://github.com/crossplane/crossplane-tools/blob/master/README.md><code>angryjet</code> documentation</a>.</p><p>Note that in many cases a suitable provider will already exist. Frequently
adding support for a new managed service requires only the definition of the
managed resource itself.</p><h3 id=managed-resource-kinds>Managed Resource Kinds</h3><p>Managed resources must:</p><ul><li>Satisfy crossplane-runtime&rsquo;s <a href=https://godoc.org/github.com/crossplane/crossplane-runtime/pkg/resource#Managed><code>resource.Managed</code></a> interface.</li><li>Embed a <a href=https://godoc.org/github.com/crossplane/crossplane-runtime/apis/common/v1#ResourceStatus><code>ResourceStatus</code></a> struct in their <code>Status</code> struct.</li><li>Embed a <a href=https://godoc.org/github.com/crossplane/crossplane-runtime/apis/common/v1#ResourceSpec><code>ResourceSpec</code></a> struct in their <code>Spec</code> struct.</li><li>Embed a <code>Parameters</code> struct in their <code>Spec</code> struct.</li><li>Use the <code>+kubebuilder:subresource:status</code> <a href=https://kubebuilder.io/reference/markers.html>comment marker</a>.</li><li>Use the <code>+kubebuilder:resource:scope=Cluster</code> <a href=https://kubebuilder.io/reference/markers.html>comment marker</a>.</li></ul><p>The <code>Parameters</code> struct should be a <em>high fidelity</em> representation of the
writeable fields of the external resource&rsquo;s API. Put otherwise, if your
favourite cloud represents Favourite DB instances as a JSON object then
<code>FavouriteDBParameters</code> should marshal to a something as close to that JSON
object as possible while still complying with Kubernetes API conventions.</p><p>For example, assume the external API object for Favourite DB instance was:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>42</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;mycoolinstance&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;fanciness_level&#34;</span>: <span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;2.3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#e6db74>&#34;ONLINE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;hostname&#34;</span>: <span style=color:#e6db74>&#34;cool.fcp.example.org&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Further assume the <code>id</code>, <code>status</code>, and <code>hostname</code> fields were output only, and
the <code>version</code> field was optional. The <code>FavouriteDBInstance</code> managed resource
should look as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// FavouriteDBInstanceParameters define the desired state of an FavouriteDB
</span></span></span><span style=display:flex><span><span style=color:#75715e>// instance. Most fields map directly to an Instance:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// https://favourite.example.org/api/v1/db#Instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstanceParameters</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// We&#39;re still working on a standard for naming external resources. See
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// https://github.com/crossplane/crossplane/issues/624 for context.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Name of this instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Note that fanciness_level becomes fancinessLevel below. Kubernetes API
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// conventions trump cloud provider fidelity.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// FancinessLevel specifies exactly how fancy this instance is.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>FancinessLevel</span> <span style=color:#66d9ef>int</span> <span style=color:#e6db74>`json:&#34;fancinessLevel&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Version specifies what version of FancySQL this instance will run.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// +optional
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Version</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;version,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A FavouriteDBInstanceSpec defines the desired state of a FavouriteDBInstance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstanceSpec</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>ResourceSpec</span>  <span style=color:#e6db74>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ForProvider</span> <span style=color:#a6e22e>FavouriteDBInstanceParameters</span> <span style=color:#e6db74>`json:&#34;forProvider&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A FavouriteDBInstanceStatus represents the observed state of a
</span></span></span><span style=display:flex><span><span style=color:#75715e>// FavouriteDBInstance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstanceStatus</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>ResourceStatus</span> <span style=color:#e6db74>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Note that we add the three &#34;output only&#34; fields here in the status,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// instead of the parameters. We want this representation to be high
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// fidelity just like the parameters.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ID of this instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>ID</span> <span style=color:#66d9ef>int</span> <span style=color:#e6db74>`json:&#34;id,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Status of this instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Status</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;status,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Hostname of this instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Hostname</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;hostname,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A FavouriteDBInstance is a managed resource that represents a Favourite DB
</span></span></span><span style=display:flex><span><span style=color:#75715e>// instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// +kubebuilder:subresource:status
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstance</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>TypeMeta</span>   <span style=color:#e6db74>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ObjectMeta</span> <span style=color:#e6db74>`json:&#34;metadata,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Spec</span>   <span style=color:#a6e22e>FavouriteDBInstanceSpec</span>   <span style=color:#e6db74>`json:&#34;spec&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span> <span style=color:#a6e22e>FavouriteDBInstanceStatus</span> <span style=color:#e6db74>`json:&#34;status,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Note that Crossplane uses the GoDoc strings of API kinds to generate user facing
API documentation. <strong>Document all fields</strong> and prefer GoDoc that assumes the
reader is running <code>kubectl explain</code>, or reading an API reference, not reading
the code. Refer to the <a href=https://github.com/crossplane/crossplane/blob/master/design/one-pager-managed-resource-api-design.md>Managed Resource API Patterns</a> one pager for more detail
on authoring high fidelity managed resources.</p><h3 id=provider-kinds>Provider Kinds</h3><p>You&rsquo;ll typically only need to add a new Provider kind if you&rsquo;re creating an
infrastructure provider that adds support for a new infrastructure provider.</p><p>Providers must:</p><ul><li>Be named exactly <code>ProviderConfig</code>.</li><li>Embed a <a href=https://godoc.org/github.com/crossplane/crossplane-runtime/apis/common/v1#ProviderSpec><code>ProviderSpec</code></a> struct in their <code>Spec</code> struct.</li><li>Use the <code>+kubebuilder:resource:scope=Cluster</code> <a href=https://kubebuilder.io/reference/markers.html>comment marker</a>.</li></ul><p>The Favourite Cloud <code>ProviderConfig</code> would look as follows. Note that the cloud to
which it belongs should be indicated by its API group, i.e. its API Version
would be <code>favouritecloud.crossplane.io/v1alpha1</code> or similar.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// A ProviderSpec defines the desired state of a Provider.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ProviderSpec</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>ProviderSpec</span> <span style=color:#e6db74>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Information required outside of the Secret referenced in the embedded
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// xpv1.ProviderSpec that is required to authenticate to the provider.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// ProjectID is used as an example here.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>ProjectID</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;projectID&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A Provider configures a Favourite Cloud &#39;provider&#39;, i.e. a connection to a
</span></span></span><span style=display:flex><span><span style=color:#75715e>// particular Favourite Cloud project using a particular Favourite Cloud service
</span></span></span><span style=display:flex><span><span style=color:#75715e>// account.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Provider</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>TypeMeta</span>   <span style=color:#e6db74>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ObjectMeta</span> <span style=color:#e6db74>`json:&#34;metadata,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Spec</span> <span style=color:#a6e22e>ProviderSpec</span> <span style=color:#e6db74>`json:&#34;spec&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=finishing-touches>Finishing Touches</h3><p>At this point we&rsquo;ve defined the managed resource necessary to start
building controllers. Before moving on to the controllers:</p><ul><li>Add any kubebuilder <a href=https://kubebuilder.io/reference/markers.html>comment markers</a> that may be useful for your resource.
Comment markers can be used to validate input, or add additional columns to
the standard <code>kubectl get</code> output, among other things.</li><li>Run <code>make reviewable</code> to generate Custom Resource Definitions and additional
helper methods for your new resource kinds.</li><li>Make sure any package documentation (i.e. <code>// Package v1alpha1...</code> GoDoc,
including package level comment markers) are in a file named <code>doc.go</code>.
kubebuilder adds them to <code>groupversion_info.go</code>, but several code generation
tools only check <code>doc.go</code>.</li></ul><p>Finally, add convenience <a href=https://godoc.org/k8s.io/apimachinery/pkg/runtime/schema#GroupVersionKind><code>GroupVersionKind</code></a> variables for each new resource
kind. These are typically added to either <code>register.go</code> or
<code>groupversion_info.go</code> depending on which version of kubebuilder scaffolded the
API type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// FavouriteDBInstance type metadata.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>FavouriteDBInstanceKind</span>             = <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>TypeOf</span>(<span style=color:#a6e22e>FavouriteDBInstance</span>{}).<span style=color:#a6e22e>Name</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>FavouriteDBInstanceKindAPIVersion</span>   = <span style=color:#a6e22e>FavouriteDBInstanceKind</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>GroupVersion</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>FavouriteDBInstanceGroupVersionKind</span> = <span style=color:#a6e22e>GroupVersion</span>.<span style=color:#a6e22e>WithKind</span>(<span style=color:#a6e22e>FavouriteDBInstanceKind</span>)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Consider opening a draft pull request and asking a Crossplane maintainer for
review before you start work on the controller!</p><h2 id=adding-controllers>Adding Controllers</h2><p>Crossplane controllers, like those scaffolded by kubebuilder, are built around
the <a href=https://github.com/kubernetes-sigs/controller-runtime>controller-runtime</a> library. controller-runtime flavoured controllers
encapsulate most of their domain-specific logic in a <a href=https://godoc.org/sigs.k8s.io/controller-runtime/pkg/reconcile#Reconciler><code>reconcile.Reconciler</code></a>
implementation. Most Crossplane controllers are one of the three kinds mentioned
under <a href=#what-makes-a-crossplane-infrastructure-resource>What Makes a Crossplane Infrastructure Resource</a>. Each of these controller kinds
are similar enough across implementations that <a href=https://github.com/crossplane/crossplane-runtime/>crossplane-runtime</a> provides
&lsquo;default&rsquo; reconcilers. These reconcilers encode what the Crossplane community
has learned about managing external systems and narrow the problem space from
reconciling a Kubernetes resource kind with an arbitrary system down to
Crossplane-specific tasks.</p><p>crossplane-runtime provides the following <code>reconcile.Reconcilers</code>:</p><ul><li>The <a href=https://godoc.org/github.com/crossplane/crossplane-runtime/pkg/reconciler/managed#Reconciler><code>managed.Reconciler</code></a> reconciles managed resources with external systems
by instantiating a client of the external API and using it to create, update,
or delete the external resource as necessary.</li></ul><p>Crossplane controllers typically differ sufficiently from those scaffolded by
kubebuilder that there is little value in using kubebuilder to generate a
controller scaffold.</p><h3 id=managed-resource-controllers>Managed Resource Controllers</h3><p>Managed resource controllers should use <a href=https://godoc.org/github.com/crossplane/crossplane-runtime/pkg/reconciler/managed#NewReconciler><code>managed.NewReconciler</code></a> to wrap a
managed-resource specific implementation of <a href=https://godoc.org/github.com/crossplane/crossplane-runtime/pkg/reconciler/managed#ExternalConnecter><code>managed.ExternalConnecter</code></a>. Parts
of <code>managed.Reconciler</code>&rsquo;s behaviour is customisable; refer to the
<a href=https://godoc.org/github.com/crossplane/crossplane-runtime/pkg/reconciler/managed#NewReconciler><code>managed.NewReconciler</code></a> GoDoc for a list of options. The following is an
example controller for the <code>FavouriteDBInstance</code> managed resource we defined
earlier:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/pkg/errors&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>corev1</span> <span style=color:#e6db74>&#34;k8s.io/api/core/v1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/types&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctrl</span> <span style=color:#e6db74>&#34;sigs.k8s.io/controller-runtime&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sigs.k8s.io/controller-runtime/pkg/client&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// An API client of the hypothetical FavouriteDB service.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#34;github.com/fcp-sdk/v1/services/database&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xpv1</span> <span style=color:#e6db74>&#34;github.com/crossplane/crossplane-runtime/apis/common/v1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/crossplane/crossplane-runtime/pkg/meta&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/crossplane/crossplane-runtime/pkg/resource&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/crossplane/crossplane-runtime/pkg/reconciler/managed&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/crossplane/provider-fcp/apis/database/v1alpha3&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fcpv1alpha3</span> <span style=color:#e6db74>&#34;github.com/crossplane/provider-fcp/apis/v1alpha3&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FavouriteDBInstanceController</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SetupWithManager instantiates a new controller using a managed.Reconciler
</span></span></span><span style=display:flex><span><span style=color:#75715e>// configured to reconcile FavouriteDBInstances using an ExternalClient produced by
</span></span></span><span style=display:flex><span><span style=color:#75715e>// connecter, which satisfies the ExternalConnecter interface.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>FavouriteDBInstanceController</span>) <span style=color:#a6e22e>SetupWithManager</span>(<span style=color:#a6e22e>mgr</span> <span style=color:#a6e22e>ctrl</span>.<span style=color:#a6e22e>Manager</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ctrl</span>.<span style=color:#a6e22e>NewControllerManagedBy</span>(<span style=color:#a6e22e>mgr</span>).
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Named</span>(<span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToLower</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s.%s&#34;</span>, <span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstanceKind</span>, <span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>Group</span>))).
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>For</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstance</span>{}).
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Complete</span>(<span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>NewReconciler</span>(<span style=color:#a6e22e>mgr</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>ManagedKind</span>(<span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstanceGroupVersionKind</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>WithExternalConnecter</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>connecter</span>{<span style=color:#a6e22e>client</span>: <span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>GetClient</span>()})))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Connecter satisfies the resource.ExternalConnecter interface.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>connecter</span> <span style=color:#66d9ef>struct</span>{ <span style=color:#a6e22e>client</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Client</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Connect to the supplied resource.Managed (presumed to be a
</span></span></span><span style=display:flex><span><span style=color:#75715e>// FavouriteDBInstance) by using the Provider it references to create a new
</span></span></span><span style=display:flex><span><span style=color:#75715e>// database client.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>connecter</span>) <span style=color:#a6e22e>Connect</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>mg</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Managed</span>) (<span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalClient</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Assert that resource.Managed we were passed in fact contains a
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// FavouriteDBInstance. We told NewControllerManagedBy that this was a
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// controller For FavouriteDBInstance, so something would have to go
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// horribly wrong for us to encounter another type.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mg</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstance</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;managed resource is not a FavouriteDBInstance&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get the Provider referenced by the FavouriteDBInstance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>fcpv1alpha3</span>.<span style=color:#a6e22e>Provider</span>{}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>NamespacedNameOf</span>(<span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>ProviderReference</span>), <span style=color:#a6e22e>p</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;cannot get Provider&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get the Secret referenced by the Provider.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>corev1</span>.<span style=color:#a6e22e>Secret</span>{}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>NamespacedName</span>{<span style=color:#a6e22e>Namespace</span>: <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Namespace</span>, <span style=color:#a6e22e>Name</span>: <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Secret</span>.<span style=color:#a6e22e>Name</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>s</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;cannot get Provider secret&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create and return a new database client using the credentials read from
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// our Provider&#39;s Secret.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>client</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>NewClient</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Data</span>[<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Secret</span>.<span style=color:#a6e22e>Key</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>external</span>{<span style=color:#a6e22e>client</span>: <span style=color:#a6e22e>client</span>}, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;cannot create client&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// External satisfies the resource.ExternalClient interface.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>external</span> <span style=color:#66d9ef>struct</span>{ <span style=color:#a6e22e>client</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>Client</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Observe the existing external resource, if any. The managed.Reconciler
</span></span></span><span style=display:flex><span><span style=color:#75715e>// calls Observe in order to determine whether an external resource needs to be
</span></span></span><span style=display:flex><span><span style=color:#75715e>// created, updated, or deleted.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>external</span>) <span style=color:#a6e22e>Observe</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>mg</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Managed</span>) (<span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalObservation</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mg</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstance</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalObservation</span>{}, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;managed resource is not a FavouriteDBInstance&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Use our FavouriteDB API client to get an up to date view of the external
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// resource.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>existing</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>GetInstance</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If we encounter an error indicating the external resource does not exist
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// we want to let the managed.Reconciler know so it can create it.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>IsNotFound</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalObservation</span>{<span style=color:#a6e22e>ResourceExists</span>: <span style=color:#66d9ef>false</span>}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Any other errors are wrapped (as is good Go practice) and returned to the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// managed.Reconciler. It will update the &#34;Synced&#34; status condition
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// of the managed resource to reflect that the most recent reconcile failed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// and ensure the reconcile is reattempted after a brief wait.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalObservation</span>{}, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;cannot get instance&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// The external resource exists. Copy any output-only fields to their
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// corresponding entries in our status field.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Status</span>.<span style=color:#a6e22e>Status</span> = <span style=color:#a6e22e>existing</span>.<span style=color:#a6e22e>GetStatus</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Status</span>.<span style=color:#a6e22e>Hostname</span> = <span style=color:#a6e22e>existing</span>.<span style=color:#a6e22e>GetHostname</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Status</span>.<span style=color:#a6e22e>ID</span> = <span style=color:#a6e22e>existing</span>.<span style=color:#a6e22e>GetID</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update our &#34;Ready&#34; status condition to reflect the status of the external
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// resource. Most managed resources use the below well known reasons that
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// the &#34;Ready&#34; status may be true or false, but managed resource authors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// are welcome to define and use their own.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Status</span>.<span style=color:#a6e22e>Status</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>StatusOnline</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>SetBindable</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>SetConditions</span>(<span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>Available</span>())
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>StatusCreating</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>SetConditions</span>(<span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>Creating</span>())
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>StatusDeleting</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>SetConditions</span>(<span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>Deleting</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Finally, we report what we know about the external resource. In this
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// hypothetical case FancinessLevel is the only field that can be updated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// after creation time, so the resource does not need to be updated if
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// the actual fanciness level matches our desired fanciness level. Any
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// ConnectionDetails we return will be published to the managed resource&#39;s
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// connection secret if it specified one.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>o</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalObservation</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ResourceExists</span>:   <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ResourceUpToDate</span>: <span style=color:#a6e22e>existing</span>.<span style=color:#a6e22e>GetFancinessLevel</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>FancinessLevel</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ConnectionDetails</span>: <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ConnectionDetails</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>ResourceCredentialsSecretUserKey</span>:     []byte(<span style=color:#a6e22e>existing</span>.<span style=color:#a6e22e>GetUsername</span>()),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>ResourceCredentialsSecretEndpointKey</span>: []byte(<span style=color:#a6e22e>existing</span>.<span style=color:#a6e22e>GetHostname</span>()),
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>o</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create a new external resource based on the specification of our managed
</span></span></span><span style=display:flex><span><span style=color:#75715e>// resource. managed.Reconciler only calls Create if Observe reported
</span></span></span><span style=display:flex><span><span style=color:#75715e>// that the external resource did not exist.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>external</span>) <span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>mg</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Managed</span>) (<span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalCreation</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mg</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstance</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalCreation</span>{}, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;managed resource is not a FavouriteDBInstance&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Indicate that we&#39;re about to create the instance. Remember ExternalClient
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// authors can use a bespoke condition reason here in cases where Creating
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// doesn&#39;t make sense.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>SetConditions</span>(<span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>Creating</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create must return any connection details that are set or returned only
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// at creation time. The managed.Reconciler will merge any details
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// with those returned during the Observe phase.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>password</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>GeneratePassword</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cd</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ConnectionDetails</span>{<span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>ResourceCredentialsSecretPasswordKey</span>: []byte(<span style=color:#a6e22e>password</span>)}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create a new instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>new</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>Instance</span>{<span style=color:#a6e22e>Name</span>: <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>FancinessLevel</span>: <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>FancinessLevel</span>, <span style=color:#a6e22e>Version</span>: <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Version</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CreateInstance</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>new</span>, <span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Note that we use resource.Ignore to squash any error that indicates the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// external resource already exists. Create implementations must not return
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// an error if asked to create a resource that already exists. Real managed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// resource controllers are advised to avoid unintentially &#39;adoptign&#39; an
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// existing, unrelated external resource, per
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// https://github.com/crossplane/crossplane-runtime/issues/27
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalCreation</span>{<span style=color:#a6e22e>ConnectionDetails</span>: <span style=color:#a6e22e>cd</span>}, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Ignore</span>(<span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>IsExists</span>, <span style=color:#a6e22e>err</span>), <span style=color:#e6db74>&#34;cannot create instance&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Update the existing external resource to match the specifications of our
</span></span></span><span style=display:flex><span><span style=color:#75715e>// managed resource. managed.Reconciler only calls Update if Observe
</span></span></span><span style=display:flex><span><span style=color:#75715e>// reported that the external resource was not up to date.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>external</span>) <span style=color:#a6e22e>Update</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>mg</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Managed</span>) (<span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalUpdate</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mg</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstance</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalUpdate</span>{}, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;managed resource is not a FavouriteDBInstance&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Recall that FancinessLevel is the only field that we _can_ update.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>new</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>Instance</span>{<span style=color:#a6e22e>Name</span>: <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>FancinessLevel</span>: <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>FancinessLevel</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>UpdateInstance</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>new</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>managed</span>.<span style=color:#a6e22e>ExternalUpdate</span>{}, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;cannot update instance&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Delete the external resource. managed.Reconciler only calls Delete
</span></span></span><span style=display:flex><span><span style=color:#75715e>// when a managed resource with the &#39;Delete&#39; deletion policy (the default) has
</span></span></span><span style=display:flex><span><span style=color:#75715e>// been deleted.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>external</span>) <span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>mg</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Managed</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mg</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>v1alpha3</span>.<span style=color:#a6e22e>FavouriteDBInstance</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;managed resource is not a FavouriteDBInstance&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Indicate that we&#39;re about to delete the instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>SetConditions</span>(<span style=color:#a6e22e>xpv1</span>.<span style=color:#a6e22e>Deleting</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Delete the instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>DeleteInstance</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Note that we use resource.Ignore to squash any error that indicates the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// external resource does not exist. Delete implementations must not return
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// an error when asked to delete a non-existent external resource.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Ignore</span>(<span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>IsNotFound</span>, <span style=color:#a6e22e>err</span>), <span style=color:#e6db74>&#34;cannot delete instance&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=wrapping-up>Wrapping Up</h3><p>Once all your controllers are in place you&rsquo;ll want to test them. Note that most
projects under the <a href=https://github.com/crossplane>crossplane org</a> <a href=https://github.com/crossplane/crossplane/issues/452>favor</a> table driven tests that use Go&rsquo;s
standard library <code>testing</code> package over kubebuilder&rsquo;s Gingko based tests. Please
do not add or proliferate Gingko based tests.</p><p>Finally, don&rsquo;t forget to plumb any newly added resource kinds and controllers up
to your controller manager. Simple providers may do this for each type within
within <code>main()</code>, but most more complicated providers take an approach in which
each package exposes an <code>AddToScheme</code> (for resource kinds) or <code>SetupWithManager</code>
(for controllers) function that invokes the same function within its child
packages, resulting in a <code>main.go</code> like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sigs.k8s.io/controller-runtime/pkg/client/config&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sigs.k8s.io/controller-runtime/pkg/manager&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sigs.k8s.io/controller-runtime/pkg/manager/signals&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>crossplaneapis</span> <span style=color:#e6db74>&#34;github.com/crossplane/crossplane/apis&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fcpapis</span> <span style=color:#e6db74>&#34;github.com/crossplane/provider-fcp/apis&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/crossplane/provider-fcp/pkg/controller&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cfg</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>GetConfig</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mgr</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>manager</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>cfg</span>, <span style=color:#a6e22e>manager</span>.<span style=color:#a6e22e>Options</span>{<span style=color:#a6e22e>SyncPeriod</span>: <span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Hour</span>})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>crossplaneapis</span>.<span style=color:#a6e22e>AddToScheme</span>(<span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>GetScheme</span>()); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fcpapis</span>.<span style=color:#a6e22e>AddToScheme</span>(<span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>GetScheme</span>()); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>controller</span>.<span style=color:#a6e22e>SetupWithManager</span>(<span style=color:#a6e22e>mgr</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    panic(<span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#a6e22e>signals</span>.<span style=color:#a6e22e>SetupSignalHandler</span>()))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=in-review>In Review</h2><p>In this guide we walked through the process of defining the resource kinds and
controllers necessary to build support for new managed infrastructure; possibly
even a completely new infrastructure provider. Please do not hesitate to <a href=https://github.com/crossplane/crossplane#get-involved>reach
out</a> to the Crossplane maintainers and community for help designing and
implementing support for new managed services. We would highly value any
feedback you may have about the development process!</p></div></div><script>var i,j,menu=[],menuDom,item,itemDom,children;menu.push({childCurrent:!1,children:[{current:!1,name:"Install \u0026 Configure",url:"/v1.7/getting-started/install-configure/"},{current:!1,name:"Provision Infrastructure",url:"/v1.7/getting-started/provision-infrastructure/"},{current:!1,name:"Create a Configuration",url:"/v1.7/getting-started/create-configuration/"}],current:!1,name:"Getting Started",url:"/v1.7/getting-started/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Providers",url:"/v1.7/concepts/providers/"},{current:!1,name:"Managed Resources",url:"/v1.7/concepts/managed-resources/"},{current:!1,name:"Composite Resources",url:"/v1.7/concepts/composition/"},{current:!1,name:"Packages",url:"/v1.7/concepts/packages/"},{current:!1,name:"Terminology",url:"/v1.7/concepts/terminology/"}],current:!1,name:"Concepts",url:"/v1.7/concepts/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Upgrading to v0.14",url:"/v1.7/guides/upgrading-to-v0.14/"},{current:!1,name:"Upgrading to v1.x",url:"/v1.7/guides/upgrading-to-v1.x/"},{current:!1,name:"Vault as an External Secret Store",url:"/v1.7/guides/vault-as-secret-store/"},{current:!1,name:"Vault Credential Injection",url:"/v1.7/guides/vault-injection/"},{current:!1,name:"Multi-Tenant Crossplane",url:"/v1.7/guides/multi-tenant/"},{current:!1,name:"Composition Revisions",url:"/v1.7/guides/composition-revisions/"},{current:!1,name:"Self-Signed CA Certs",url:"/v1.7/guides/self-signed-ca-certs/"}],current:!1,name:"Guides",url:"/v1.7/guides/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Install Crossplane",url:"/v1.7/reference/install/"},{current:!1,name:"Configure Your Cloud Provider Account",url:"/v1.7/reference/configure/"},{current:!1,name:"Uninstall",url:"/v1.7/reference/uninstall/"},{current:!1,name:"Composition",url:"/v1.7/reference/composition/"},{current:!1,name:"xpkg Specification",url:"/v1.7/reference/xpkg/"},{current:!1,name:"Troubleshoot",url:"/v1.7/reference/troubleshoot/"},{current:!1,name:"Learn More",url:"/v1.7/reference/learn_more/"},{current:!1,name:"Release Cycle",url:"/v1.7/reference/release-cycle/"}],current:!1,name:"Reference",url:"/v1.7/reference/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"crossplane",url:"/v1.7/api-docs/crossplane/"},{current:!1,name:"provider-alibaba",url:"/v1.7/api-docs/provider-alibaba/"},{current:!1,name:"provider-aws",url:"/v1.7/api-docs/provider-aws/"},{current:!1,name:"provider-azure",url:"/v1.7/api-docs/provider-azure/"},{current:!1,name:"provider-gcp",url:"/v1.7/api-docs/provider-gcp/"},{current:!1,name:"provider-rook",url:"/v1.7/api-docs/provider-rook/"},{current:!1,name:"provider-helm",url:"/v1.7/api-docs/provider-helm/"}],current:!1,name:"API Documentation",url:"/v1.7/api-docs/"}),menu.push({childCurrent:!0,children:[{current:!0,name:"Provider Development Guide",url:"/v1.7/contributing/provider_development_guide/"},{current:!1,name:"Observability Developer Guide",url:"/v1.7/contributing/observability_developer_guide/"},{current:!1,name:"Release Process",url:"/v1.7/contributing/release-process/"},{current:!1,name:"Adding Secret Store Support",url:"/v1.7/contributing/adding_external_secret_store_support/"}],current:!1,name:"Contributing",url:"/v1.7/contributing/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Related Projects",url:"/v1.7/faqs/related_projects/"}],current:!1,name:"FAQ",url:"/v1.7/faqs/"});function getEntry(e){var t=document.createElement("li");return e.current?(t.innerHTML=e.name,t.classList.add("current")):t.innerHTML='<a href="'+e.url+'">'+e.name+"</a>",t}function flushCss(e){e.offsetHeight}function addArrow(e){var t=document.createElement("a");t.classList.add("arrow"),t.innerHTML="<div />",t.onclick=function(e){return function(){var n=59,s=16,t=n+s+e.lastChild.clientHeight+"px";return e.classList.toggle("open"),e.classList.contains("open")?e.style.height=t:(e.style.height==="auto"&&(e.style.transition="none",e.style.height=t,flushCss(e),e.style.transition=""),e.style.height="59px"),!1}}(e),e.appendChild(t),item.current&&item.children||item.childCurrent?(e.classList.add("open"),e.style.height="auto"):e.style.height="59px"}menuDom=document.getElementById("docs-ul");for(i=0;i<menu.length;i++){if(item=menu[i],itemDom=getEntry(item),item.childCurrent&&itemDom.classList.add("childCurrent"),item.children){addArrow(itemDom),itemDom.classList.add("children"),children=document.createElement("ul");for(j=0;j<item.children.length;j++)children.appendChild(getEntry(item.children[j]));itemDom.appendChild(children)}menuDom.appendChild(itemDom)}</script><script src=/js/anchor.js></script>
<script>anchors.options={placement:"right",icon:"#"},document.addEventListener("DOMContentLoaded",function(){anchors.add(".docs-content h1, .docs-content h2, .docs-content h3, .docs-content h4, .docs-content h5, .docs-content h6")})</script><div id=footer><div class=footer-main><div class=main><div class=logo><img src=/images/logo.svg alt="Crossplane Logo"></div></div><div class="links sm-hidden"><a href=https://twitter.com/crossplane_io>Twitter</a>
<a href=/v1.9/>Documentation</a>
<a href=https://github.com/crossplane/crossplane>GitHub</a>
<a href=https://slack.crossplane.io/>Slack Channel</a>
<a href=https://www.youtube.com/channel/UC19FgzMBMqBro361HbE46Fw>YouTube</a>
<a href=https://groups.google.com/forum/#!forum/crossplane-dev>Forum</a></div></div><div class=lf-copyright><p>&#169; Crossplane Authors 2022. Documentation distributed under
<a href=https://creativecommons.org/licenses/by/4.0/>CC-BY-4.0</a>.</p><p>&#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
<a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> page.</p></div><script src=/js/slack-popup.js></script></div><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-110275540-2","auto"),ga("send","pageview")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-SFCPQYSLHY"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SFCPQYSLHY")</script><script type=text/javascript id=hs-script-loader async defer src=https://js.hs-scripts.com/5557732.js></script></body></html>