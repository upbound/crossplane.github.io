<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Crossplane is a framework for building cloud native control planes without needing to write code. It has a highly extensible backend that enables you to build a control plane that can orchestrate applications and infrastructure no matter where they run, and a highly configurable frontend that puts you in control of the schema of the declarative API it offers."><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=robots content="noindex"><title>| Crossplane Documentation</title><meta name=twitter:card content="summary"><meta name=twitter:site content="https://crossplane.io"><meta name=twitter:title content="Crossplane"><meta name=twitter:description content="The cloud-native control plane framework"><meta name=twitter:image:src content="https://crossplane.io/images/twitter-card_400x400.jpg"><link rel=apple-touch-icon sizes=180x180 href="/favicons/apple-touch-icon.png?v=1.0"><link rel=icon type=image/png sizes=32x32 href="/favicons/favicon-32x32.png?v=1.0"><link rel=icon type=image/png sizes=16x16 href="/favicons/favicon-16x16.png?v=1.0"><link rel=manifest href="/favicons/site.webmanifest?v=1.0"><link rel=mask-icon href="/favicons/safari-pinned-tab.svg?v=1.0" color=#5bbad5><link rel="shortcut icon" href="/favicons/favicon.ico?v=1.0"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css><link rel=stylesheet href=/css/docs.css><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js></script></head><body><div id=header><div><div class=logo><a href=/><img src=/images/logo.svg alt="Crossplane Logo"></a></div><div class=hamburger-controls onclick='return document.body.classList.contains("menu-open")?document.body.classList.remove("menu-open"):document.body.classList.add("menu-open"),!1'><span></span>
<span></span>
<span></span></div><ul class=links><li><a href=https://github.com/crossplane/crossplane><span class=md-hidden>Get Started on</span> GitHub</a></li><li><a href=/v1.9/>Documentation</a></li><li><a href=/community/>Community</a></li><li><a href=https://slack.crossplane.io/>Slack <span class=md-hidden>Channel</span></a></li><li><a href=https://blog.crossplane.io/>Blog</a></li><li><a href=https://twitter.com/crossplane_io>Twitter</a></li></ul></div></div><div id=docs-header><div><h1>Documentation</h1><div class=versions><div><div><select onchange="window.location.href=this.value"><option selected value=/master/cloud-providers/azure/azure-provider/>Crossplane master</option><option value=/v1.9/cloud-providers/aws/aws-provider/>Crossplane v1.9</option><option value=/v1.9/cloud-providers/azure/azure-provider/>Crossplane v1.9</option><option value=/v1.9/cloud-providers/gcp/gcp-provider/>Crossplane v1.9</option><option value=/v1.8/cloud-providers/aws/aws-provider/>Crossplane v1.8</option><option value=/v1.8/cloud-providers/azure/azure-provider/>Crossplane v1.8</option><option value=/v1.8/cloud-providers/gcp/gcp-provider/>Crossplane v1.8</option><option value=/v1.8/media/readme/>Crossplane v1.8</option><option selected value=/v1.7/cloud-providers/aws/aws-provider/>Crossplane v1.7</option><option selected value=/v1.7/cloud-providers/azure/azure-provider/>Crossplane v1.7</option><option selected value=/v1.7/cloud-providers/gcp/gcp-provider/>Crossplane v1.7</option><option selected value=/v1.7/media/readme/>Crossplane v1.7</option></select></div></div></div></div></div><div class=page><div class=docs-menu><ul id=docs-ul></ul></div><div class=docs-content><div class=docs-actions><a id=edit href=https://github.com/crossplane/crossplane/tree/release-1.7/docs/azure-provider.md><img src=/images/github-teal.svg>Edit on GitHub</a></div><div class="alert old"><p><b>PLEASE NOTE</b>: This document applies to version 1.7 and not to the latest release 1.9</p><strong>Documentation for other releases can be found by using the version selector in the top right of any doc page.</strong></div><h1></h1><h1 id=adding-microsoft-azure-to-crossplane>Adding Microsoft Azure to Crossplane</h1><p>In this guide, we will walk through the steps necessary to configure your Azure
account to be ready for integration with Crossplane. The general steps we will
take are summarized below:</p><ul><li>Create a new service principal (account) that Crossplane will use to create
and manage Azure resources</li><li>Add the required permissions to the account</li><li>Consent to the permissions using an administrator account</li></ul><h2 id=preparing-your-microsoft-azure-account>Preparing your Microsoft Azure Account</h2><p>In order to manage resources in Azure, you must provide credentials for a Azure
service principal that Crossplane can use to authenticate. This assumes that you
have already <a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli?view=azure-cli-latest">set up the Azure CLI
client</a>
with your credentials.</p><p>Create a JSON file that contains all the information needed to connect and
authenticate to Azure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create service principal with Owner role</span>
</span></span><span style=display:flex><span>az ad sp create-for-rbac --sdk-auth --role Owner &gt; crossplane-azure-provider-key.json
</span></span></code></pre></div><p>Take note of the <code>clientID</code> value from the JSON file that we just created, and
save it to an environment variable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export AZURE_CLIENT_ID<span style=color:#f92672>=</span>&lt;clientId value from json file&gt;
</span></span></code></pre></div><p>Now add the required permissions to the service principal that will allow it to
manage the necessary resources in Azure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># add required Azure Active Directory permissions</span>
</span></span><span style=display:flex><span>az ad app permission add --id <span style=color:#e6db74>${</span>AZURE_CLIENT_ID<span style=color:#e6db74>}</span> --api 00000002-0000-0000-c000-000000000000 --api-permissions 1cda74f2-2616-4834-b122-5cb1b07f8a59<span style=color:#f92672>=</span>Role 78c8a3c8-a07e-4b9e-af1b-b5ccab50a175<span style=color:#f92672>=</span>Role
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># grant (activate) the permissions</span>
</span></span><span style=display:flex><span>az ad app permission grant --id <span style=color:#e6db74>${</span>AZURE_CLIENT_ID<span style=color:#e6db74>}</span> --api 00000002-0000-0000-c000-000000000000 --expires never
</span></span></code></pre></div><p>You might see an error similar to the following, but that is OK, the permissions
should have gone through still:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>Operation failed with status: &#39;Conflict&#39;. Details: 409 Client Error: Conflict for url: https://graph.windows.net/e7985bc4-a3b3-4f37-b9d2-fa256023b1ae/oauth2PermissionGrants?api-version=1.6
</span></span></code></pre></div><p>Finally, you need to grant admin permissions on the Azure Active Directory to
the service principal because it will need to create other service principals
for your <code>AKSCluster</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># grant admin consent to the service princinpal you created</span>
</span></span><span style=display:flex><span>az ad app permission admin-consent --id <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>AZURE_CLIENT_ID<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>Note: You might need <code>Global Administrator</code> role to <code>Grant admin consent for Default Directory</code>. Please contact the administrator of your Azure subscription.
To check your role, go to <code>Azure Active Directory</code> -> <code>Roles and administrators</code>. You can find your role(s) by clicking on <code>Your Role (Preview)</code></p><p>After these steps are completed, you should have the following file on your
local filesystem:</p><ul><li><code>crossplane-azure-provider-key.json</code></li></ul><h2 id=setup-azure-providerconfig>Setup Azure ProviderConfig</h2><p>Before creating any resources, we need to create and configure an Azure cloud
provider resource in Crossplane, which stores the cloud account information in
it. All the requests from Crossplane to Azure Cloud will use the credentials
attached to this provider resource. The following command assumes that you have
a <code>crossplane-azure-provider-key.json</code> file that belongs to the account youâ€™d
like Crossplane to use.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>BASE64ENCODED_AZURE_ACCOUNT_CREDS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>base64 crossplane-azure-provider-key.json | tr -d <span style=color:#e6db74>&#34;\n&#34;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>Now weâ€™ll create our <code>Secret</code> that contains the credential and <code>ProviderConfig</code>
resource that refers to that secret:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt; provider.yaml <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Secret
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: azure-account-creds
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: crossplane-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type: Opaque
</span></span></span><span style=display:flex><span><span style=color:#e6db74>data:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  credentials: ${BASE64ENCODED_AZURE_ACCOUNT_CREDS}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: azure.crossplane.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ProviderConfig
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  credentials:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    source: Secret
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    secretRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      namespace: crossplane-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: azure-account-creds
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      key: credentials
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># apply it to the cluster:</span>
</span></span><span style=display:flex><span>kubectl apply -f <span style=color:#e6db74>&#34;provider.yaml&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># delete the credentials variable</span>
</span></span><span style=display:flex><span>unset BASE64ENCODED_AZURE_ACCOUNT_CREDS
</span></span></code></pre></div><p>The output will look like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>secret/azure-user-creds created
</span></span><span style=display:flex><span>provider.azure.crossplane.io/default created
</span></span></code></pre></div><p>Crossplane resources use the <code>ProviderConfig</code> named <code>default</code> if no specific
<code>ProviderConfig</code> is specified, so this <code>ProviderConfig</code> will be the default for
all Azure resources.</p></div></div><script>var i,j,menu=[],menuDom,item,itemDom,children;menu.push({childCurrent:!1,children:[{current:!1,name:"Install \u0026 Configure",url:"/v1.7/getting-started/install-configure/"},{current:!1,name:"Provision Infrastructure",url:"/v1.7/getting-started/provision-infrastructure/"},{current:!1,name:"Create a Configuration",url:"/v1.7/getting-started/create-configuration/"}],current:!1,name:"Getting Started",url:"/v1.7/getting-started/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Providers",url:"/v1.7/concepts/providers/"},{current:!1,name:"Managed Resources",url:"/v1.7/concepts/managed-resources/"},{current:!1,name:"Composite Resources",url:"/v1.7/concepts/composition/"},{current:!1,name:"Packages",url:"/v1.7/concepts/packages/"},{current:!1,name:"Terminology",url:"/v1.7/concepts/terminology/"}],current:!1,name:"Concepts",url:"/v1.7/concepts/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Upgrading to v0.14",url:"/v1.7/guides/upgrading-to-v0.14/"},{current:!1,name:"Upgrading to v1.x",url:"/v1.7/guides/upgrading-to-v1.x/"},{current:!1,name:"Vault as an External Secret Store",url:"/v1.7/guides/vault-as-secret-store/"},{current:!1,name:"Vault Credential Injection",url:"/v1.7/guides/vault-injection/"},{current:!1,name:"Multi-Tenant Crossplane",url:"/v1.7/guides/multi-tenant/"},{current:!1,name:"Composition Revisions",url:"/v1.7/guides/composition-revisions/"},{current:!1,name:"Self-Signed CA Certs",url:"/v1.7/guides/self-signed-ca-certs/"}],current:!1,name:"Guides",url:"/v1.7/guides/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Install Crossplane",url:"/v1.7/reference/install/"},{current:!1,name:"Configure Your Cloud Provider Account",url:"/v1.7/reference/configure/"},{current:!1,name:"Uninstall",url:"/v1.7/reference/uninstall/"},{current:!1,name:"Composition",url:"/v1.7/reference/composition/"},{current:!1,name:"xpkg Specification",url:"/v1.7/reference/xpkg/"},{current:!1,name:"Troubleshoot",url:"/v1.7/reference/troubleshoot/"},{current:!1,name:"Learn More",url:"/v1.7/reference/learn_more/"},{current:!1,name:"Release Cycle",url:"/v1.7/reference/release-cycle/"}],current:!1,name:"Reference",url:"/v1.7/reference/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"crossplane",url:"/v1.7/api-docs/crossplane/"},{current:!1,name:"provider-alibaba",url:"/v1.7/api-docs/provider-alibaba/"},{current:!1,name:"provider-aws",url:"/v1.7/api-docs/provider-aws/"},{current:!1,name:"provider-azure",url:"/v1.7/api-docs/provider-azure/"},{current:!1,name:"provider-gcp",url:"/v1.7/api-docs/provider-gcp/"},{current:!1,name:"provider-rook",url:"/v1.7/api-docs/provider-rook/"},{current:!1,name:"provider-helm",url:"/v1.7/api-docs/provider-helm/"}],current:!1,name:"API Documentation",url:"/v1.7/api-docs/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Provider Development Guide",url:"/v1.7/contributing/provider_development_guide/"},{current:!1,name:"Observability Developer Guide",url:"/v1.7/contributing/observability_developer_guide/"},{current:!1,name:"Release Process",url:"/v1.7/contributing/release-process/"},{current:!1,name:"Adding Secret Store Support",url:"/v1.7/contributing/adding_external_secret_store_support/"}],current:!1,name:"Contributing",url:"/v1.7/contributing/"}),menu.push({childCurrent:!1,children:[{current:!1,name:"Related Projects",url:"/v1.7/faqs/related_projects/"}],current:!1,name:"FAQ",url:"/v1.7/faqs/"});function getEntry(e){var t=document.createElement("li");return e.current?(t.innerHTML=e.name,t.classList.add("current")):t.innerHTML='<a href="'+e.url+'">'+e.name+"</a>",t}function flushCss(e){e.offsetHeight}function addArrow(e){var t=document.createElement("a");t.classList.add("arrow"),t.innerHTML="<div />",t.onclick=function(e){return function(){var n=59,s=16,t=n+s+e.lastChild.clientHeight+"px";return e.classList.toggle("open"),e.classList.contains("open")?e.style.height=t:(e.style.height==="auto"&&(e.style.transition="none",e.style.height=t,flushCss(e),e.style.transition=""),e.style.height="59px"),!1}}(e),e.appendChild(t),item.current&&item.children||item.childCurrent?(e.classList.add("open"),e.style.height="auto"):e.style.height="59px"}menuDom=document.getElementById("docs-ul");for(i=0;i<menu.length;i++){if(item=menu[i],itemDom=getEntry(item),item.childCurrent&&itemDom.classList.add("childCurrent"),item.children){addArrow(itemDom),itemDom.classList.add("children"),children=document.createElement("ul");for(j=0;j<item.children.length;j++)children.appendChild(getEntry(item.children[j]));itemDom.appendChild(children)}menuDom.appendChild(itemDom)}</script><script src=/js/anchor.js></script>
<script>anchors.options={placement:"right",icon:"#"},document.addEventListener("DOMContentLoaded",function(){anchors.add(".docs-content h1, .docs-content h2, .docs-content h3, .docs-content h4, .docs-content h5, .docs-content h6")})</script><div id=footer><div class=footer-main><div class=main><div class=logo><img src=/images/logo.svg alt="Crossplane Logo"></div></div><div class="links sm-hidden"><a href=https://twitter.com/crossplane_io>Twitter</a>
<a href=/v1.9/>Documentation</a>
<a href=https://github.com/crossplane/crossplane>GitHub</a>
<a href=https://slack.crossplane.io/>Slack Channel</a>
<a href=https://www.youtube.com/channel/UC19FgzMBMqBro361HbE46Fw>YouTube</a>
<a href=https://groups.google.com/forum/#!forum/crossplane-dev>Forum</a></div></div><div class=lf-copyright><p>&#169; Crossplane Authors 2022. Documentation distributed under
<a href=https://creativecommons.org/licenses/by/4.0/>CC-BY-4.0</a>.</p><p>&#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
<a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a> page.</p></div><script src=/js/slack-popup.js></script></div><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-110275540-2","auto"),ga("send","pageview")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-SFCPQYSLHY"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SFCPQYSLHY")</script><script type=text/javascript id=hs-script-loader async defer src=https://js.hs-scripts.com/5557732.js></script></body></html>